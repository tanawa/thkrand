<!DOCTYPE html>
<html>
<head>
	<title></title>
	<meta name="viewport" content="width=device-width,initial-scale=1.0">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	<meta charset="utf-8">
	<script src="https://www.gstatic.com/firebasejs/7.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.6.1/firebase-database.js"></script>
    <script src='https://cdn.rawgit.com/admsev/jquery-play-sound/master/jquery.playSound.js'></script>
    <style type="text/css">
    	@import url('https://fonts.googleapis.com/css?family=Kanit&display=swap');
    	@keyframes popup{
        0%{transform: scale(0,0);}
        50%{transform: scale(1.1,1.1);}
        100%{transform: scale(1,1);}
      }
      @keyframes startani{
        0%{transform: rotate(1deg);}
        50%{transform: rotate(4deg);}
        100%{transform: rotate(1deg);}
      }
      body{
    		overflow: hidden;
    		margin:0;
    		padding: 0;
    		background-color:#f9dcd6;
        background-image: linear-gradient(#f9dcd6, #fff);
    		font-family: 'Kanit', sans-serif;
    	}
    	#main{
        height:790px;
    		width: 100%;
    		display: block;
    		margin:0;
        background-image:url('bg.png');
        background-size: cover;
    	}
    	#rand{
    		margin-top:320px;
    		text-align: center;
    		font-family: 'Kanit', sans-serif;
    		font-size: 40pt;
    	}
      #load{
        margin-top:320px;
        margin-left:30%;
      }
      #img{
        
      }
    	.im-mar{
    		margin-left:10%;
    	}
    	#listname{
        padding: 10PX 25PX;
    		background-color:#fff;
    		display: block;
    		position:relative;
    		width: 300px;
    		height:620px;
    		float:right;
    		margin-top:40px;
    		margin-right:40px;
    		margin-bottom:40px;
    		border-radius: 15px;
        overflow: scroll;
        font-size: 25px;
    		opacity: 0.6;
    	}
      a{
        position: absolute;
        animation-duration: 0.5s;
        animation-name: popup;
      }
      
      #logoStart{
        position:absolute;
        animation-name:startani;
        animation-duration: 1s;
        animation-iteration-count:infinite;

      }
      @keyframes moveon{
        0%{transform: scale(1,1);opacity: 1;}
        100%{transform: scale(5,5);opacity: 0.1;}
      }
      .moveon{
        animation-name: moveon;
        animation-duration: 2s;
        position: absolute;
      }
      @keyframes moveup{
        0%{opacity: 0;}
        100%{opacity: 1;}
      }
      .moveup{
        animation-name: moveup;
        animation-duration: 0.5s;
        position: relative;
      }
    </style>
</head>
<body>


<div id="main">
	<br>
  <br>
	<img src="logo.png" width="40%" class="im-mar" id="logoStart">
  
  <div id="listname">
    
  </div>

  <h1 id="rand">ชื่อ นามสกุล</h1>
  <img src="" width="90px" id="load">
  
</div>
<div id="intro">
	<img src="img1.jpg" width="100%" height="790">
</div>
<div id="img">
	<img src="img1.jpg" width="100%" height="790" id="mo">
</div>


<script type="text/javascript">
var deletes=false;
	$("#img").hide();
  	$("#intro").hide();
    $("#rand").show();
    $("#load").hide();
  	//$("#main").hide();
	var firebaseConfig = {
    apiKey: "AIzaSyAS8FVZdUsHQykpoZEB-uAHRHQYSLPnatg",
    authDomain: "testmes-2fcf4.firebaseapp.com",
    databaseURL: "https://testmes-2fcf4.firebaseio.com",
    projectId: "testmes-2fcf4",
    storageBucket: "testmes-2fcf4.appspot.com",
    messagingSenderId: "866846768783",
    appId: "1:866846768783:web:6ef7269027340cfc"
  };
  firebase.initializeApp(firebaseConfig);
  var ref=firebase.database().ref("deletethk");
  ref.once("value",function(snapshot){
    if(snapshot.val()==true){
      deletes=true;
    }
    console.log("setting delete :"+deletes);
  },function(err){

  });
var ref=firebase.database().ref("remote/remote");
var temp=0;
var black=[];
function myFunction(data){

  $("#rand").show();
    $("#load").hide();
    $("#listname").prepend("<a>"+data+"</a><br>");
    $("#rand").addClass("moveup");
    $.playSound('sound.mp3');
}
function checkblack(item){
  if(black.length==0){
    return true;
  }
  for(let m=0;m<black.length;m++){
    if(black[m]==item){
      return false;
    }
    return true;
  }
}
function setscreen(){

}
function random(types){
  $("#rand").hide();
  $("#rand").removeClass("moveup");
    $("#load").show();
	if(types=="ทั้งหมด"){
let a1=Math.floor(Math.random()*6);
	let a2=Math.floor(Math.random()*22);
	let a3=Math.floor(Math.random()*50);
	ref=firebase.database().ref("thkrand/"+a1+"/"+a2+"/"+a3);
	ref.once("value",function(snapshot){
		if(snapshot.val()==null){
			
      random(types);
      console.log("ซ้ำ");
		}else{
			if(temp==5){
        temp=0;
        ref=firebase.database().ref("randthk");
        ref.once("value",function(snapshot){
          if(snapshot.val()!=null){
            y=Object.values(snapshot.val());
          k=Object.keys(snapshot.val());
          console.log(k);
          ran=Math.floor(Math.random()*y.length);
          console.log(y[ran]);
          o=y[ran];
          o=o.split(",");
          document.getElementById("rand").innerHTML="ม."+o[0];
          setTimeout(myFunction(o[1]), 200);
          if(deletes){
            ref=firebase.database().ref("randthk/"+k[ran]);
            ref.remove();
          }
        }else{
          random(types);
      console.log("ซ้ำ");
        }
        },function(err){

        });
      }else{
        temp+=1;
        if(checkblack(snapshot.val())){
          console.log(deletes);
          if(deletes){
            ref=firebase.database().ref("thkrand/"+a1+"/"+a2+"/"+a3);
            ref.remove();
            console.log("DELETE");
          }
          document.getElementById("rand").innerHTML="ม."+a1+"/"+a2+" เลขที่ "+a3+"<br>"+snapshot.val();
          setTimeout(myFunction(snapshot.val()), 200);
        }else{

        }
        
      }
		}
	},function(err){
		console.log("error");
	});
	}else{
	types=types.replace("มัธยมศึกษาชั้นปีที่ ","");
	console.log(types);
    let a1=types;
	let a2=Math.floor(Math.random()*22);
	let a3=Math.floor(Math.random()*50);
	ref=firebase.database().ref("thkrand/"+a1+"/"+a2+"/"+a3);
	ref.once("value",function(snapshot){
		if(snapshot.val()==null){
			random(types);
      console.log("ซ้ำ");
		}else{
      if(deletes){
            ref=firebase.database().ref("thkrand/"+a1+"/"+a2+"/"+a3);
            ref.remove();
            console.log("DELETE");
          }
			document.getElementById("rand").innerHTML="ม."+a1+"/"+a2+" เลขที่ "+a3+"<br>"+snapshot.val();
      setTimeout(myFunction(snapshot.val()), 200);
       $("#rand").show();
    $("#load").hide();

		}
	},function(err){
		console.log("error");
	});
	}
}


  ref=firebase.database().ref("remote/remote");

  ref.on("value",function(snapshot){
    ref=firebase.database().ref("remote/remote");
    ref.remove();
  	if(snapshot.val()!=null){
  		let ans=snapshot.val();
  		if(ans=="เปิดตัว"){
  			$("#intro").show();
  			$("#img").hide();
  			$("#main").hide();
        ref=firebase.database().ref("remote/remote");
  			ref.remove();
  		}else if(ans=="ภาพ1"){
  			$("#img").show();
  			$("#intro").hide();
  			$("#main").hide();
        $("#mo").addClass("moveon");
        setTimeout(function(){
          $("#main").show();
  $("#intro").hide();
  $("#img").hide();
  console.log("dsa");
$("#mo").removeClass("moveon");
        }, 1000);
        ref=firebase.database().ref("remote/remote");
  			ref.remove();
  		}else{
  			if(ans.length==2){
  				$("#main").show();
  				$("#intro").hide();
  				$("#img").hide();
  				console.log(ans[0]);
  				console.log(ans[1]);
  				for(let y=0;y<ans[0];y++){
  					random(ans[1]);
            ref=firebase.database().ref("remote/remote");
            ref.remove();
  				}
          ref=firebase.database().ref("remote/remote");
  				ref.remove();
  			}
  		}
      ref=firebase.database().ref("remote/remote");
  		ref.remove();
  	}
  },function(err){
  	console.log("error");
  });
</script>
</body>
</html>