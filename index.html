<!DOCTYPE html>
<html>
<head>
	<title></title>
	<meta name="viewport" content="width=device-width,initial-scale=1.0">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	<meta charset="utf-8">
	<script src="https://www.gstatic.com/firebasejs/7.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.6.1/firebase-database.js"></script>
    <style type="text/css">
    	@import url('https://fonts.googleapis.com/css?family=Kanit&display=swap');
    	@keyframes popup{
        0%{transform: scale(0,0);}
        50%{transform: scale(1.1,1.1);}
        100%{transform: scale(1,1);}
      }
      body{
    		overflow: hidden;
    		margin:0;
    		padding: 0;
    		background-color:#f9dcd6;
    		font-family: 'Kanit', sans-serif;
    	}
    	#main{
        height:640px;
    		width: 100%;
    		display: block;
    		margin:0;
        background-image:url('bg.png');
        background-size: cover;
    	}
    	#rand{
    		margin-top:20px;
    		text-align: center;
    		font-family: 'Kanit', sans-serif;
    		font-size: 60pt;
    	}
      #load{
        margin-top:10px;
        margin-left:30%;
      }
    	.im-mar{
    		margin-left:10%;
    	}
    	#listname{
        padding: 10PX 25PX;
    		background-color:#fff;
    		display: block;
    		position:relative;
    		width: 600px;
    		height:550px;
    		float:right;
    		margin-top:40px;
    		margin-right:40px;
    		margin-bottom:40px;
    		border-radius: 15px;
        overflow: scroll;
        font-size: 25px;
    		opacity: 0.6;
    	}
      a{
        position: absolute;
        animation-duration: 0.5s;
        animation-name: popup;
      }
    </style>
</head>
<body>
  <audio id="myAudio">
    <source src="sound.ogg" type="audio/ogg">
  <source src="sound.mp3" type="audio/mpeg">
</audio>

<div id="main">
	
	<img src="logo.png" width="40%" class="im-mar">
  
  <div id="listname">
    
  </div>

  <h1 id="rand">ชื่อ นามสกุล</h1>
  <img src="load.gif" width="90px" id="load">
  
  
</div>
<div id="intro">
	intro
</div>
<div id="img">
	<img src="img1.jpg" width="100%">
</div>
<script type="text/javascript">
  
	$("#img").hide();
  	$("#intro").hide();
    $("#rand").show();
    $("#load").hide();
  	//$("#main").hide();
	var firebaseConfig = {
    apiKey: "AIzaSyAS8FVZdUsHQykpoZEB-uAHRHQYSLPnatg",
    authDomain: "testmes-2fcf4.firebaseapp.com",
    databaseURL: "https://testmes-2fcf4.firebaseio.com",
    projectId: "testmes-2fcf4",
    storageBucket: "testmes-2fcf4.appspot.com",
    messagingSenderId: "866846768783",
    appId: "1:866846768783:web:6ef7269027340cfc"
  };
  firebase.initializeApp(firebaseConfig);
var ref=firebase.database().ref("remote/remote");

function myFunction(data){
  let x = document.getElementById("myAudio"); 
  $("#rand").show();
    $("#load").hide();
    $("#listname").prepend("<a>"+data+"</a><br>");
    x.play(); 
}
function random(types){
  $("#rand").hide();
    $("#load").show();
	if(types=="ทั้งหมด"){
let a1=Math.floor(Math.random()*6);
	let a2=Math.floor(Math.random()*22);
	let a3=Math.floor(Math.random()*50);
	ref=firebase.database().ref("thkrand/"+a1+"/"+a2+"/"+a3);
	ref.once("value",function(snapshot){
		if(snapshot.val()==null){
			random(types);
		}else{
			document.getElementById("rand").innerHTML=snapshot.val();
      setTimeout(myFunction(snapshot.val()), 5000);
		}
	},function(err){
		console.log("error");
	});
	}else{
	types=types.replace("มัธยมศึกษาชั้นปีที่ ","");
	console.log(types);
    let a1=types;
	let a2=Math.floor(Math.random()*22);
	let a3=Math.floor(Math.random()*50);
	ref=firebase.database().ref("thkrand/"+a1+"/"+a2+"/"+a3);
	ref.once("value",function(snapshot){
		if(snapshot.val()==null){
			random(types);
		}else{
			document.getElementById("rand").innerHTML=snapshot.val();
      setTimeout(myFunction(snapshot.val()), 5000);
		}
	},function(err){
		console.log("error");
	});
	}
}



  ref=firebase.database().ref("remote/remote");

  ref.on("value",function(snapshot){
    ref.remove();
  	if(snapshot.val()!=null){
  		let ans=snapshot.val();
  		if(ans=="เปิดตัว"){
  			$("#intro").show();
  			$("#img").hide();
  			$("#main").hide();
  			ref.remove();
  		}else if(ans=="ภาพ1"){
  			$("#img").show();
  			$("#intro").hide();
  			$("#main").hide();
  			ref.remove();
  		}else{
  			if(ans.length==2){
  				$("#main").show();
  				$("#intro").hide();
  				$("#img").hide();
  				console.log(ans[0]);
  				console.log(ans[1]);
  				for(let y=0;y<ans[0];y++){
  					random(ans[1]);
            ref.remove();
  				}
  				ref.remove();
  			}
  		}
  		ref.remove();
  	}
  },function(err){
  	console.log("error");
  });
</script>
</body>
</html>